<!DOCTYPE html>
<html>
<head>
    <title>Steel Flower</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner"></div>
        </div>

        <nav class="main-nav">
            <div class="nav-gradient"></div>
            <div class="nav-inner">
                <button class="nav-button active" onclick="showSection('home')">
                    <span>Home</span>
                    <div class="nav-line"></div>
                </button>
                <button class="nav-button" onclick="showSection('blacklist')">
                    <span>Blacklist</span>
                    <div class="nav-line"></div>
                </button>
                <button class="nav-button dimmed" onclick="showComingSoon('tournaments')">
                    <span>Tournaments</span>
                    <div class="nav-line"></div>
                </button>
                <button class="nav-button dimmed" onclick="showComingSoon('rules')">
                    <span>Rules</span>
                    <div class="nav-line"></div>
                </button>
            </div>
        </nav>

        <!-- Home Section -->
        <div id="home-section" class="content-section">
            <h1 class="animate-pop">Welcome to Steel Flower</h1>
            
            <div class="description animate-slide">
                <p>Welcome to Steel Flower Tournaments. We are a Critical Ops tournament organization that aims to bring the best experience to the Critical Ops Competitive Scene.</p>
            </div>

            <div class="social-container">
                <a href="https://discord.gg/encdzGBrND" target="_blank" class="social-button">
                    <i class="fab fa-discord social-icon"></i>
                    <h3>Discord Server</h3>
                    <p>Join our community</p>
                    <div class="social-hover-effect"></div>
                </a>
                
                <a href="https://www.twitter.com/SteelFlowerGG" target="_blank" class="social-button">
                    <i class="fab fa-x-twitter social-icon"></i>
                    <h3>X (Twitter)</h3>
                    <p>Follow our updates</p>
                    <div class="social-hover-effect"></div>
                </a>
                
                <a href="https://www.youtube.com/@SteelFlower" target="_blank" class="social-button">
                    <i class="fab fa-youtube social-icon"></i>
                    <h3>YouTube</h3>
                    <p>Watch our content</p>
                    <div class="social-hover-effect"></div>
                </a>
            </div>
        </div>

        <!-- Blacklist Section -->
        <div id="blacklist-section" class="content-section section-hidden">
            <h1 class="animate-pop">STEEL FLOWER BLACKLIST</h1>
            
            <div class="description animate-slide">
                <p>The Steel Flower Blacklist maintains competitive integrity in our tournaments by tracking players who violated rules through cheating, unsportsmanlike conduct, or other prohibited activities. This list ensures fair play for all participants.</p>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search by IGN, Game ID, or Reason..." 
                       onfocus="this.placeholder=''" onblur="this.placeholder='Search by IGN, Game ID, or Reason...'">
                <div class="search-tools">
                    <button class="search-clear" onclick="clearSearch()">&times;</button>
                </div>
            </div>

            <!-- Statistics Bar -->
            <div class="stats-bar">
                <span>Total Entries: <span id="totalCount">0</span></span>
                <span>Active: <span id="activeCount">0</span></span>
                <span>Inactive: <span id="inactiveCount">0</span></span>
            </div>

            <table id="blacklistTable">
                <thead>
                    <tr>
                        <th>IGN</th>
                        <th>GAME ID</th>
                        <th>REASON</th>
                        <th>STATUS</th>
                        <th>DATE ADDED</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>

            <!-- Player Detail Modal -->
            <div id="playerModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div class="profile-header">
                        <h2 id="modalIGN"></h2>
                    </div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <span class="detail-label">Discord ID</span>
                            <span id="discordID" class="detail-value"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Game ID</span>
                            <span id="modalGameID" class="detail-value"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status</span>
                            <span id="modalStatus" class="detail-value"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Date Added</span>
                            <span id="modalDate" class="detail-value"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coming Soon Sections -->
        <div id="tournaments-section" class="content-section section-hidden">
            <h1>TOURNAMENTS</h1>
            <div class="description">
                <p>Tournaments section coming soon! Stay tuned for competitive events and challenges.</p>
            </div>
        </div>

        <div id="rules-section" class="content-section section-hidden">
            <h1>RULES & REGULATIONS</h1>
            <div class="description">
                <p>Official rules and regulations section coming soon. Check back later for detailed guidelines.</p>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Navigation Handling
        let currentSection = 'home';
        const animationDuration = 300;

        function showSection(sectionId) {
            if (sectionId === currentSection) return;

            showLoading();

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('section-hidden');
            });
            
            currentSection = sectionId;

            // Update button classes
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
                if (button.querySelector('span').textContent.toLowerCase().trim() === sectionId) {
                    button.classList.add('active');
                }
            });

            setTimeout(() => {
                // Show new section
                document.getElementById(`${sectionId}-section`).classList.remove('section-hidden');

                if (sectionId === 'blacklist') {
                    updateURL('/blacklist');
                    if (originalData.length === 0) {
                        fetchBlacklistData();
                    } else {
                        updateStats();
                    }
                } else {
                    updateURL('/');
                }

                hideLoading();
            }, animationDuration);
        }

        function showComingSoon(sectionId) {
            showSection(sectionId);
        }

        // Initialize active state
        document.addEventListener('DOMContentLoaded', () => {
            // Hide all sections except home
            document.querySelectorAll('.content-section').forEach(section => {
                if (section.id !== 'home-section') {
                    section.classList.add('section-hidden');
                }
            });
        });

        // Enhanced Data Handling
        let originalData = [];
        let searchTimeout;

        async function fetchBlacklistData() {
            showLoading();
            try {
                const response = await fetch('/api/blacklist');
                const data = await response.json();
                originalData = data.data;
                updateTable(originalData);
                updateStats();
                setupTableSorting();
            } catch(error) {
                console.error('Error fetching data:', error);
            }
            hideLoading();
        }

        // Enhanced Search with Debounce
        document.getElementById('searchInput').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const filter = this.value.toLowerCase();
                const filteredData = originalData.filter(entry => 
                    Object.values(entry).some(value => 
                        String(value).toLowerCase().includes(filter)
                    )
                );
                updateTable(filteredData);
                updateStats(filteredData);
            }, 300);
        });

        // New Features
        function updateStats(data = originalData) {
            document.getElementById('totalCount').textContent = data.length;
            document.getElementById('activeCount').textContent = 
                data.filter(entry => entry.status.toLowerCase() === 'active').length;
            document.getElementById('inactiveCount').textContent = 
                data.filter(entry => entry.status.toLowerCase() === 'inactive').length;
        }

        function setupTableSorting() {
            document.querySelectorAll('#blacklistTable th').forEach((header, index) => {
                header.style.cursor = 'pointer';
                header.addEventListener('click', () => sortTable(index));
            });
        }

        function sortTable(columnIndex) {
            const tbody = document.querySelector('#blacklistTable tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                const aValue = a.children[columnIndex].textContent;
                const bValue = b.children[columnIndex].textContent;
                return aValue.localeCompare(bValue, undefined, {numeric: true});
            });

            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }

        // Loading Animation
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        // Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if(e.key === '/' && document.activeElement !== document.getElementById('searchInput')) {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                if(e.key === 'Escape') {
                    document.getElementById('playerModal').style.display = 'none';
                }
            });
        }

        // Existing Functions
        function updateURL(path) {
            const state = { page: path.replace('/', '') };
            history.pushState(state, '', path);
        }

        function updateTable(data) {
            const tbody = document.querySelector('#blacklistTable tbody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr class="no-results"><td colspan="5">No matching records found</td></tr>`;
                return;
            }

            data.forEach(entry => {
                const row = document.createElement('tr');
                const formattedStatus = entry.status.charAt(0).toUpperCase() + entry.status.slice(1).toLowerCase();
                const formattedDate = new Date(entry.date_added).toLocaleDateString('en-GB', dateOptions);

                row.innerHTML = `
                    <td>${entry.ign}</td>
                    <td>${entry.game_id}</td>
                    <td>${entry.reason}</td>
                    <td class="status-${formattedStatus.toLowerCase()}">${formattedStatus}</td>
                    <td>${formattedDate}</td>
                `;
                row.addEventListener('click', () => showPlayerDetails(entry));
                tbody.appendChild(row);
            });
        }

        function showPlayerDetails(player) {
            const modal = document.getElementById('playerModal');
            modal.style.display = 'block';
            
            document.getElementById('modalIGN').textContent = player.ign;
            document.getElementById('discordID').textContent = player.discord_id;
            document.getElementById('modalGameID').textContent = player.game_id;
            document.getElementById('modalStatus').textContent = player.status;
            document.getElementById('modalDate').textContent = 
                new Date(player.date_added).toLocaleDateString('en-GB', dateOptions);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            fetchBlacklistData();
            setupKeyboardShortcuts();
        });

        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.page) {
                showSection(event.state.page);
            } else {
                showSection('home');
            }
        });

        document.querySelector('.close').addEventListener('click', () => {
            document.getElementById('playerModal').style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            const modal = document.getElementById('playerModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            updateTable(originalData);
            updateStats();
        }

        const dateOptions = { year: 'numeric', month: 'short', day: 'numeric' };
        showSection('home');
    </script>
</body>
</html>